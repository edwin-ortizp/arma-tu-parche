const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TinderStack-BUVwa2If.js","assets/framer-motion-B4_CJGXS.js","assets/card-BlfsYPae.js","assets/index-DDKkWTPz.js","assets/radix-ui-C_8bfTb2.js","assets/firebase-CKBzFk3f.js","assets/ui-utils-B2rm_Apj.js","assets/index-DnpvWf-R.css","assets/PageHeader-DMY0rhfM.js","assets/x-H883-MYU.js","assets/EmptyState-CUUEHLXk.js"])))=>i.map(i=>d[i]);
import{c as U,d as N,a as E,u as F,U as V,_ as G}from"./index-DDKkWTPz.js";import{j as e,r as j}from"./framer-motion-B4_CJGXS.js";import{P as O}from"./PageHeader-DMY0rhfM.js";import{E as _,C as T,M as I}from"./EmptyState-CUUEHLXk.js";import{C as W,a as B,b as J,c as K}from"./card-BlfsYPae.js";import{A as z,a as H,u as Q}from"./useConnections-DTsSFndD.js";import{C as X}from"./check-CzBoarbt.js";import{h as L,f as $,d as M,s as P,e as q}from"./firebase-CKBzFk3f.js";import"./radix-ui-C_8bfTb2.js";import"./ui-utils-B2rm_Apj.js";/**
 * @license lucide-react v0.408.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=U("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.408.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=U("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);function Z({connections:t,selected:x,onSelectionChange:h,compact:s=!1}){const p=[{uid:"solo",name:"Solo",relation:"solo"},...t];if(s&&x){const n=p.find(g=>g.uid===x);if(n)return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-8 h-8",children:e.jsx(H,{className:`text-white text-xs font-semibold ${n.uid==="solo"?"bg-gradient-to-br from-gray-400 to-slate-500":"bg-gradient-to-br from-blue-400 to-cyan-500"}`,children:n.name.charAt(0).toUpperCase()})}),e.jsx("div",{children:e.jsx("p",{className:"font-medium text-sm",children:n.uid==="solo"?"Planes para mí":`Con ${n.name}`})})]}),e.jsx("button",{onClick:()=>h(""),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Cambiar"})]})}return e.jsxs(W,{className:"bg-muted/50 w-full",children:[e.jsx(B,{className:"pb-3",children:e.jsx(J,{className:"text-lg",children:"¿Con quién planeas?"})}),e.jsx(K,{children:e.jsx("div",{className:"grid grid-cols-3 gap-2 sm:grid-cols-4 md:grid-cols-5",children:p.map(n=>e.jsxs("button",{onClick:()=>h(n.uid),className:`
                relative p-3 rounded-lg border-2 transition-all duration-200 hover:scale-105
                ${x===n.uid?"border-brand-primary bg-brand-primary/10 shadow-lg":"border-border hover:border-brand-primary/50 bg-background"}
              `,children:[x===n.uid&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-brand-primary rounded-full flex items-center justify-center shadow-lg",children:e.jsx(X,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(z,{className:"w-10 h-10",children:e.jsx(H,{className:`text-white text-sm font-semibold ${n.uid==="solo"?"bg-gradient-to-br from-gray-400 to-slate-500":"bg-gradient-to-br from-blue-400 to-cyan-500"}`,children:n.name.charAt(0).toUpperCase()})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs font-medium truncate max-w-[60px]",children:n.name})})]})]},n.uid))})})]})}function ee(t=!1,x=""){const[h,s]=j.useState([]),[m,p]=j.useState(!0),[n,g]=j.useState(null),b=async()=>{try{p(!0),g(null);const i=await L($(N,"dates")),c=Date.now();let d=i.docs.map(a=>({id:a.id,...a.data()})).filter(a=>{const u=a.active&&(!a.expiresAt||new Date(a.expiresAt).getTime()>c),f=t?!0:a.relationType==="solo";return u&&f});if(t&&E.currentUser&&x){const a=E.currentUser.uid,u=x==="solo"?a:x,w=(await L($(N,"likes"))).docs.map(r=>r.data()).filter(r=>{const S=r.userId===a,A=r.companionId===u||!r.companionId&&x==="solo";return S&&A}).map(r=>r.dateId),k=(await L($(N,"matches"))).docs.map(r=>r.data()).filter(r=>{const S=r.users.includes(a),A=r.users.includes(u);return S&&A}).map(r=>r.dateId),y=[...new Set([...w,...k])];d=d.filter(r=>!y.includes(r.id))}const o=d.sort(()=>Math.random()-.5);s(o)}catch(i){console.error("Error al cargar planes:",i),g("Error al cargar planes")}finally{p(!1)}};return j.useEffect(()=>{b()},[t,x]),{dates:h,loading:m,error:n,likeDate:async(i,c)=>{var d;const l=E.currentUser;if(!l)throw new Error("Usuario no autenticado");try{const o=c==="solo"?l.uid:c,a=`${l.uid}_${o}_${i}`,u=M(N,"likes",a);if(await P(u,{userId:l.uid,dateId:i,companionId:o,liked:!0,createdAt:Date.now()},{merge:!0}),c==="solo"||c===l.uid)return{hasMatch:!1,isNewMatch:!1};try{const f=`${c}_${l.uid}_${i}`,w=M(N,"likes",f),v=await q(w);if(v.exists()&&((d=v.data())==null?void 0:d.liked)===!0){const k=`${[l.uid,c].sort().join("_")}_${i}`,y=M(N,"matches",k);try{return(await q(y)).exists()?{hasMatch:!0,isNewMatch:!1}:(await P(y,{users:[l.uid,c],dateId:i,createdAt:Date.now(),plannedFor:"",status:"pending"},{merge:!0}),{hasMatch:!0,isNewMatch:!0})}catch(r){return console.error("Error creando match:",r),{hasMatch:!1,isNewMatch:!1}}}return{hasMatch:!1,isNewMatch:!1}}catch(f){return console.error("Error verificando likes de otros usuarios:",f),{hasMatch:!1,isNewMatch:!1}}}catch(o){throw console.error("Error al dar like:",o),new Error(`Error al procesar el like: ${o instanceof Error?o.message:"Error desconocido"}`)}},dislikeDate:async(i,c="")=>{const l=E.currentUser;if(!l)throw new Error("Usuario no autenticado");try{const d=c==="solo"?l.uid:c,o=`${l.uid}_${d}_${i}`,a=M(N,"likes",o);return await P(a,{userId:l.uid,dateId:i,companionId:d,liked:!1,createdAt:Date.now()},{merge:!0}),{success:!0}}catch(d){throw console.error("Error al dar dislike:",d),new Error(`Error al procesar el dislike: ${d instanceof Error?d.message:"Error desconocido"}`)}},refreshDates:b}}function se(){const[t,x]=j.useState(""),[h,s]=j.useState(null),{user:m}=F(),p=!!m,{dates:n,loading:g,likeDate:b,dislikeDate:D,refreshDates:C}=ee(p,t),{connections:i,loading:c}=Q();return{selected:t,setSelected:x,likingDateId:h,user:m,isLogged:p,dates:n,connections:i,loading:g||c,handleLikeDate:async o=>{if(!t)return{hasMatch:!1,isNewMatch:!1};try{s(o);const a=t==="solo"?(m==null?void 0:m.uid)||"solo":t,u=await b(o,a);return console.log(u.hasMatch?"Match creado! 🎉":"Plan guardado! ✨"),u.hasMatch&&setTimeout(()=>C(),1e3),u}catch(a){throw console.error("Error al procesar el like:",a),a}finally{s(null)}},handlePassDate:async o=>{if(t)try{const a=t==="solo"?(m==null?void 0:m.uid)||"solo":t;await D(o,a),console.log("Plan marcado como no interesante para este compañero")}catch(a){console.error("Error al marcar como no interesante:",a)}}}}const ae=j.lazy(()=>G(()=>import("./TinderStack-BUVwa2If.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(t=>({default:t.TinderStack}))),te=()=>e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 dark:bg-gray-800 rounded-xl",children:e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Cargando planes..."})]})});function he(){var b,D,C,i,c,l,d,o,a,u,f,w,v,k,y,r;const{selected:t,setSelected:x,isLogged:h,dates:s,connections:m,loading:p,handleLikeDate:n,handlePassDate:g}=se();return p?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-muted rounded w-2/3"})]})}):e.jsxs("div",{className:`pb-20 ${t?"space-y-2":"space-y-6"}`,children:[!h||m.length===0||t===""?e.jsx(O,{title:"Encuentra tu Plan",description:"Descubre actividades perfectas para compartir",icon:e.jsx(Y,{className:"w-5 h-5 text-white"}),badge:{text:`${s.length} planes disponibles`,className:"bg-gradient-to-r from-green-500 to-emerald-500 text-white"}}):null,h&&m.length===0?e.jsx(_,{icon:e.jsx(V,{className:"w-8 h-8 text-muted-foreground"}),title:"¡Conecta con Amigos!",description:"Aún no tienes conexiones. Agrega amigos con su PIN para encontrar planes increíbles juntos.",tip:"Ve a la sección Amigos para conectarte"}):e.jsxs("div",{className:"flex flex-col h-[calc(100vh-120px)]",children:[h&&e.jsx("div",{className:"flex-shrink-0 px-4 mb-4",children:e.jsx(Z,{connections:m,selected:t,onSelectionChange:x,compact:t!==""})}),h&&t===""?e.jsx("div",{className:"px-4",children:e.jsx(_,{icon:e.jsx("span",{className:"text-2xl",children:"👆"}),title:"¿Con quién planeas?",description:"Elige un compañero o selecciona 'Solo' para planes individuales."})}):e.jsxs("div",{className:"flex flex-col lg:flex-row lg:gap-8 h-full",children:[e.jsx("div",{className:"flex-1 flex justify-center items-center px-2 lg:px-0",children:e.jsxs("div",{className:"w-[95vw] lg:w-full lg:max-w-[500px] space-y-4",children:[e.jsx("div",{className:"h-[calc(100vh-300px)] lg:h-[600px] relative",children:e.jsx(j.Suspense,{fallback:e.jsx(te,{}),children:e.jsx(ae,{dates:s,onLike:n,onPass:g})})}),e.jsx("div",{className:"lg:hidden",children:t&&s.length>0&&e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-gray-100",children:e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:(b=s[0])==null?void 0:b.category}),e.jsxs("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),(D=s[0])==null?void 0:D.duration]}),e.jsxs("span",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),(C=s[0])==null?void 0:C.cost]}),((i=s[0])==null?void 0:i.city)&&e.jsxs("span",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),(c=s[0])==null?void 0:c.city]}),((l=s[0])==null?void 0:l.experienceType)&&e.jsx("span",{className:"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium",children:(d=s[0])==null?void 0:d.experienceType})]})})})]})}),e.jsx("div",{className:"hidden lg:block lg:w-80 lg:flex-shrink-0 space-y-6",children:t&&s.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-900",children:"Detalles del Plan"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg text-gray-800 mb-2",children:(o=s[0])==null?void 0:o.title}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:(a=s[0])==null?void 0:a.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:(u=s[0])==null?void 0:u.category}),e.jsxs("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),(f=s[0])==null?void 0:f.duration]}),e.jsxs("span",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),(w=s[0])==null?void 0:w.cost]}),((v=s[0])==null?void 0:v.city)&&e.jsxs("span",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),(k=s[0])==null?void 0:k.city]}),((y=s[0])==null?void 0:y.experienceType)&&e.jsx("span",{className:"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium",children:(r=s[0])==null?void 0:r.experienceType})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-900",children:"💡 Cómo usar"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 font-bold",children:"→"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Me Gusta"}),e.jsx("p",{className:"text-gray-600",children:"Desliza derecha o usa el botón ❤️"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-red-600 font-bold",children:"←"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Pasar"}),e.jsx("p",{className:"text-gray-600",children:"Desliza izquierda o usa el botón ✗"})]})]})]})]})]})})]})]}),h&&t&&e.jsx("div",{className:"lg:hidden mt-8 px-6 pb-4",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100",children:e.jsxs("p",{className:"text-center text-sm text-gray-600",children:["💡 ",e.jsx("strong",{children:"Tip:"})," Desliza → para me gusta, ← para pasar"]})})})]})}export{he as default};
