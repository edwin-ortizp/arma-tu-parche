const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TinderStack-DhQDKFIC.js","assets/framer-motion-B4_CJGXS.js","assets/card-7oFUPs5h.js","assets/index-CDDxIZ99.js","assets/radix-ui-C_8bfTb2.js","assets/firebase-CKBzFk3f.js","assets/ui-utils-B2rm_Apj.js","assets/index-cNkJbOzl.css","assets/PageHeader-Dm_vFGq9.js","assets/x-DwuPMkKg.js","assets/EmptyState-Beehrz9Z.js"])))=>i.map(i=>d[i]);
import{c as U,d as N,a as C,u as F,b as V,U as G,_ as O}from"./index-CDDxIZ99.js";import{j as e,r as j}from"./framer-motion-B4_CJGXS.js";import{P as W}from"./PageHeader-Dm_vFGq9.js";import{E as _,C as T,M as I}from"./EmptyState-Beehrz9Z.js";import{C as B,a as J,b as K,c as Q}from"./card-7oFUPs5h.js";import{A as z,a as H,u as X}from"./useConnections-Bzg8IxKL.js";import{C as Y}from"./check-BaeTiSZd.js";import{h as L,f as P,d as M,s as $,e as q}from"./firebase-CKBzFk3f.js";import"./radix-ui-C_8bfTb2.js";import"./ui-utils-B2rm_Apj.js";/**
 * @license lucide-react v0.408.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=U("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.408.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=U("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);function ee({connections:a,selected:x,onSelectionChange:p,compact:s=!1}){const f=[{uid:"solo",name:"Para mí",relation:"solo"},...a];if(s&&x){const n=f.find(g=>g.uid===x);if(n)return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-8 h-8",children:e.jsx(H,{className:`text-white text-xs font-semibold ${n.uid==="solo"?"bg-gradient-to-br from-gray-400 to-slate-500":"bg-gradient-to-br from-blue-400 to-cyan-500"}`,children:n.name.charAt(0).toUpperCase()})}),e.jsx("div",{children:e.jsx("p",{className:"font-medium text-sm",children:n.uid==="solo"?"Planes para mí":`Con ${n.name}`})})]}),e.jsx("button",{onClick:()=>p(""),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Cambiar"})]})}return e.jsxs(B,{className:"bg-muted/50 w-full",children:[e.jsx(J,{className:"pb-3",children:e.jsx(K,{className:"text-lg",children:"¿Con quién planeas?"})}),e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-3 gap-2 sm:grid-cols-4 md:grid-cols-5",children:f.map(n=>e.jsxs("button",{onClick:()=>p(n.uid),className:`
                relative p-3 rounded-lg border-2 transition-all duration-200 hover:scale-105
                ${x===n.uid?"border-brand-primary bg-brand-primary/10 shadow-lg":"border-border hover:border-brand-primary/50 bg-background"}
              `,children:[x===n.uid&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-brand-primary rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Y,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(z,{className:"w-10 h-10",children:e.jsx(H,{className:`text-white text-sm font-semibold ${n.uid==="solo"?"bg-gradient-to-br from-gray-400 to-slate-500":"bg-gradient-to-br from-blue-400 to-cyan-500"}`,children:n.name.charAt(0).toUpperCase()})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs font-medium truncate max-w-[60px]",children:n.name})})]})]},n.uid))})})]})}function se(a=!1,x=""){const[p,s]=j.useState([]),[m,f]=j.useState(!0),[n,g]=j.useState(null),b=async()=>{try{f(!0),g(null);const o=await L(P(N,"dates")),c=Date.now();let d=o.docs.map(t=>({id:t.id,...t.data()})).filter(t=>{const i=t.active&&(!t.expiresAt||new Date(t.expiresAt).getTime()>c),h=a?!0:t.relationType==="solo";return i&&h});if(a&&C.currentUser&&x){const t=C.currentUser.uid,i=x==="solo"?t:x,w=(await L(P(N,"likes"))).docs.map(r=>r.data()).filter(r=>{const S=r.userId===t,A=r.companionId===i||!r.companionId&&x==="solo";return S&&A}).map(r=>r.dateId),k=(await L(P(N,"matches"))).docs.map(r=>r.data()).filter(r=>{const S=r.users.includes(t),A=r.users.includes(i);return S&&A}).map(r=>r.dateId),y=[...new Set([...w,...k])];d=d.filter(r=>!y.includes(r.id))}const u=d.sort(()=>Math.random()-.5);s(u)}catch(o){console.error("Error al cargar planes:",o),g("Error al cargar planes")}finally{f(!1)}};return j.useEffect(()=>{b()},[a,x]),{dates:p,loading:m,error:n,likeDate:async(o,c)=>{var d;const l=C.currentUser;if(!l)throw new Error("Usuario no autenticado");try{const u=c==="solo"?l.uid:c,t=`${l.uid}_${u}_${o}`,i=M(N,"likes",t);if(await $(i,{userId:l.uid,dateId:o,companionId:u,liked:!0,createdAt:Date.now()},{merge:!0}),c==="solo"||c===l.uid)return{hasMatch:!1,isNewMatch:!1};try{const h=`${c}_${l.uid}_${o}`,w=M(N,"likes",h),v=await q(w);if(v.exists()&&((d=v.data())==null?void 0:d.liked)===!0){const k=`${[l.uid,c].sort().join("_")}_${o}`,y=M(N,"matches",k);try{return(await q(y)).exists()?{hasMatch:!0,isNewMatch:!1}:(await $(y,{users:[l.uid,c],dateId:o,createdAt:Date.now(),plannedFor:"",status:"pending"},{merge:!0}),{hasMatch:!0,isNewMatch:!0})}catch(r){return console.error("Error creando match:",r),{hasMatch:!1,isNewMatch:!1}}}return{hasMatch:!1,isNewMatch:!1}}catch(h){return console.error("Error verificando likes de otros usuarios:",h),{hasMatch:!1,isNewMatch:!1}}}catch(u){throw console.error("Error al dar like:",u),new Error(`Error al procesar el like: ${u instanceof Error?u.message:"Error desconocido"}`)}},dislikeDate:async(o,c="")=>{const l=C.currentUser;if(!l)throw new Error("Usuario no autenticado");try{const d=c==="solo"?l.uid:c,u=`${l.uid}_${d}_${o}`,t=M(N,"likes",u);return await $(t,{userId:l.uid,dateId:o,companionId:d,liked:!1,createdAt:Date.now()},{merge:!0}),{success:!0}}catch(d){throw console.error("Error al dar dislike:",d),new Error(`Error al procesar el dislike: ${d instanceof Error?d.message:"Error desconocido"}`)}},refreshDates:b}}function ae(){const[a,x]=j.useState(""),[p,s]=j.useState(null),{user:m}=F(),{showToast:f}=V(),n=!!m,{dates:g,loading:b,likeDate:D,dislikeDate:E,refreshDates:o}=se(n,a),{connections:c,loading:l}=X();return{selected:a,setSelected:x,likingDateId:p,user:m,isLogged:n,dates:g,connections:c,loading:b||l,handleLikeDate:async t=>{if(!a)return{hasMatch:!1,isNewMatch:!1};try{s(t);const i=a==="solo"?(m==null?void 0:m.uid)||"solo":a,h=await D(t,i);return a==="solo"?f("Plan guardado para ti","success"):h.hasMatch?f("¡Es un match! 🎉","success"):f("Plan guardado","success"),h.hasMatch&&setTimeout(()=>o(),1e3),h}catch(i){throw console.error("Error al procesar el like:",i),i}finally{s(null)}},handlePassDate:async t=>{if(a)try{const i=a==="solo"?(m==null?void 0:m.uid)||"solo":a;await E(t,i),console.log("Plan marcado como no interesante para este compañero")}catch(i){console.error("Error al marcar como no interesante:",i)}}}}const te=j.lazy(()=>O(()=>import("./TinderStack-DhQDKFIC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(a=>({default:a.TinderStack}))),re=()=>e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 dark:bg-gray-800 rounded-xl",children:e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Cargando planes..."})]})});function pe(){var b,D,E,o,c,l,d,u,t,i,h,w,v,k,y,r;const{selected:a,setSelected:x,isLogged:p,dates:s,connections:m,loading:f,handleLikeDate:n,handlePassDate:g}=ae();return f?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-muted rounded w-2/3"})]})}):e.jsxs("div",{className:`pb-20 ${a?"space-y-2":"space-y-6"}`,children:[!p||m.length===0||a===""?e.jsx(W,{title:"Encuentra tu Plan",description:"Descubre actividades perfectas para compartir",icon:e.jsx(Z,{className:"w-5 h-5 text-white"}),badge:{text:`${s.length} planes disponibles`,className:"bg-gradient-to-r from-green-500 to-emerald-500 text-white"}}):null,p&&m.length===0?e.jsx(_,{icon:e.jsx(G,{className:"w-8 h-8 text-muted-foreground"}),title:"¡Conecta con Amigos!",description:"Aún no tienes conexiones. Agrega amigos con su PIN para encontrar planes increíbles juntos.",tip:"Ve a la sección Amigos para conectarte"}):e.jsxs("div",{className:"flex flex-col h-[calc(100vh-120px)]",children:[p&&e.jsx("div",{className:"flex-shrink-0 px-4 mb-4",children:e.jsx(ee,{connections:m,selected:a,onSelectionChange:x,compact:a!==""})}),p&&a===""?e.jsx("div",{className:"px-4",children:e.jsx(_,{icon:e.jsx("span",{className:"text-2xl",children:"👆"}),title:"¿Con quién planeas?",description:"Elige un compañero o selecciona 'Para mí' para planes individuales."})}):e.jsxs("div",{className:"flex flex-col lg:flex-row lg:gap-8 h-full",children:[e.jsx("div",{className:"flex-1 flex justify-center items-center px-2 lg:px-0",children:e.jsxs("div",{className:"w-[95vw] lg:w-full lg:max-w-[500px] space-y-4",children:[e.jsx("div",{className:"h-[calc(100vh-300px)] lg:h-[600px] relative",children:e.jsx(j.Suspense,{fallback:e.jsx(re,{}),children:e.jsx(te,{dates:s,onLike:n,onPass:g})})}),e.jsx("div",{className:"lg:hidden",children:a&&s.length>0&&e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-gray-100",children:e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:(b=s[0])==null?void 0:b.category}),e.jsxs("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),(D=s[0])==null?void 0:D.duration]}),e.jsxs("span",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),(E=s[0])==null?void 0:E.cost]}),((o=s[0])==null?void 0:o.city)&&e.jsxs("span",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),(c=s[0])==null?void 0:c.city]}),((l=s[0])==null?void 0:l.experienceType)&&e.jsx("span",{className:"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium",children:(d=s[0])==null?void 0:d.experienceType})]})})})]})}),e.jsx("div",{className:"hidden lg:block lg:w-80 lg:flex-shrink-0 space-y-6",children:a&&s.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-900",children:"Detalles del Plan"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg text-gray-800 mb-2",children:(u=s[0])==null?void 0:u.title}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:(t=s[0])==null?void 0:t.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:(i=s[0])==null?void 0:i.category}),e.jsxs("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),(h=s[0])==null?void 0:h.duration]}),e.jsxs("span",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),(w=s[0])==null?void 0:w.cost]}),((v=s[0])==null?void 0:v.city)&&e.jsxs("span",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),(k=s[0])==null?void 0:k.city]}),((y=s[0])==null?void 0:y.experienceType)&&e.jsx("span",{className:"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium",children:(r=s[0])==null?void 0:r.experienceType})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-900",children:"💡 Cómo usar"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 font-bold",children:"→"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Me Gusta"}),e.jsx("p",{className:"text-gray-600",children:"Desliza derecha o usa el botón ❤️"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-red-600 font-bold",children:"←"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Pasar"}),e.jsx("p",{className:"text-gray-600",children:"Desliza izquierda o usa el botón ✗"})]})]})]})]})]})})]})]}),p&&a&&e.jsx("div",{className:"lg:hidden mt-8 px-6 pb-4",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100",children:e.jsxs("p",{className:"text-center text-sm text-gray-600",children:["💡 ",e.jsx("strong",{children:"Tip:"})," Desliza → para me gusta, ← para pasar"]})})})]})}export{pe as default};
