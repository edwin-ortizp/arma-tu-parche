import{r as c,j as e}from"./framer-motion-B4_CJGXS.js";import{B as p,P as U}from"./PageHeader-Lihv4X5P.js";import{E as q}from"./EmptyState-DXYLOXNh.js";import L from"./index-BpYLA0jg.js";import{c as H,H as v,U as N,d as y,a as T,u as $}from"./index-CxtCZa1v.js";import{e as A,d as D,h as B,f as V}from"./firebase-CKBzFk3f.js";import{C as S,c as M}from"./button-CCKa5jUo.js";import{M as z,C as R}from"./map-pin-B0u_CyAy.js";import{S as W,a as _,b as G,C as J,c as K,d as C}from"./select-BUNPSNEw.js";import"./radix-ui-DTUURzEd.js";import"./ui-utils-BxIQ3qGg.js";import"./check-D4YSFbia.js";/**
 * @license lucide-react v0.408.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=H("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);function O({match:a}){var t;const[s,i]=c.useState(null),[l,n]=c.useState(!0);if(c.useEffect(()=>{(async()=>{try{const x=await A(D(y,"dates",a.dateId));x.exists()&&i({id:x.id,...x.data()})}catch(x){console.error("Error fetching date info:",x)}finally{n(!1)}})()},[a.dateId]),l)return e.jsxs(S,{className:"overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-pink-500 to-red-500"}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4 animate-pulse",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})})]});const d=m=>{switch(m){case"confirmed":return"bg-green-100 text-green-800";case"completed":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}},o=m=>{switch(m){case"confirmed":return"✅ Confirmado";case"completed":return"🎉 Completado";case"cancelled":return"❌ Cancelado";default:return"⏳ Pendiente"}};return e.jsxs(S,{className:"overflow-hidden hover:shadow-lg transition-all duration-200 group cursor-pointer",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-pink-500 to-red-500"}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:s?e.jsx("div",{className:"w-16 h-16 text-4xl flex items-center justify-center bg-gradient-to-br from-pink-50 to-red-50 rounded-lg border border-pink-100",children:s.image}):e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-pink-400 to-red-500 rounded-lg flex items-center justify-center",children:e.jsx(v,{className:"w-8 h-8 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(v,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:"¡Match!"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:(s==null?void 0:s.title)||"Plan desconocido"}),(s==null?void 0:s.description)&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-1 mt-1",children:s.description})]}),e.jsx(p,{className:`ml-2 flex-shrink-0 text-xs ${d(a.status)}`,children:o(a.status)})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-pink-400 to-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-white font-medium",children:((t=a.friendName)==null?void 0:t.charAt(0))||"A"})}),e.jsxs("span",{className:"font-medium",children:["Con ",a.friendName||"Amigo"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"}),e.jsx("span",{children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.users.length," personas"]})]})]}),s&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.category&&e.jsxs(p,{variant:"outline",className:"text-xs",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),s.category]}),s.duration&&e.jsxs(p,{variant:"outline",className:"text-xs",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),s.duration]}),s.cost&&e.jsxs(p,{variant:"outline",className:"text-xs",children:["💰 ",s.cost]})]}),a.plannedFor&&e.jsx("div",{className:"mt-3 p-2 bg-gradient-to-r from-pink-50 to-red-50 rounded border border-pink-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(E,{className:"w-4 h-4 text-pink-600"}),e.jsxs("span",{className:"font-medium text-pink-800",children:["Planificado para: ",a.plannedFor]})]})})]})]})})]})}function Q({friends:a,selectedFriend:s,onFriendSelect:i,totalMatches:l,filteredMatches:n}){var d,o;return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between p-4 bg-gradient-to-r from-pink-50 to-red-50 rounded-lg border border-pink-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg shadow-sm",children:e.jsx(N,{className:"w-5 h-5 text-pink-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Filtrar por amigo"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Mostrando ",n," de ",l," matches"]})]})]}),e.jsx("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:e.jsxs(W,{value:s,onValueChange:i,children:[e.jsxs(_,{className:"w-full sm:w-[200px] bg-white border-pink-200 focus:border-pink-400 focus:ring-pink-400",children:[e.jsx(G,{placeholder:"Seleccionar amigo",children:s==="all"?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Todos los amigos"]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gradient-to-br from-pink-400 to-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-white font-medium",children:((d=a.find(t=>t.uid===s))==null?void 0:d.name.charAt(0))||"A"})}),((o=a.find(t=>t.uid===s))==null?void 0:o.name)||"Amigo"]})}),e.jsx(J,{className:"w-4 h-4 opacity-50"})]}),e.jsxs(K,{children:[e.jsx(C,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),e.jsx("span",{children:"Todos los amigos"}),e.jsx(p,{variant:"secondary",className:"ml-2 text-xs",children:l})]})}),a.map(t=>e.jsx(C,{value:t.uid,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gradient-to-br from-pink-400 to-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-white font-medium",children:t.name.charAt(0)})}),e.jsx("span",{children:t.name}),e.jsx(p,{variant:"outline",className:"ml-2 text-xs",children:t.relation||"Amigo"})]})},t.uid))]})]})})]})}function X(){const[a,s]=c.useState([]),[i,l]=c.useState([]),[n,d]=c.useState("all"),[o,t]=c.useState(!0),[m,x]=c.useState(null),w=async()=>{var g;const u=(g=T.currentUser)==null?void 0:g.uid;if(!u){t(!1);return}try{x(null);const F=(await B(V(y,"matches"))).docs.map(r=>({id:r.id,...r.data()})).filter(r=>r.users.includes(u)),b=await Promise.all(F.map(async r=>{const f=r.users.find(h=>h!==u);if(f)try{const h=await A(D(y,"users",f));if(h.exists()){const j=h.data();return{...r,friendInfo:{uid:f,name:j.displayName||j.email||"Usuario",relation:j.relation||"Amigo"},friendName:j.displayName||j.email||"Usuario"}}}catch(h){console.error("Error fetching friend info:",h)}return{...r,friendName:"Usuario desconocido"}})),I=b.map(r=>r.friendInfo).filter(r=>r!==void 0).reduce((r,f)=>(r.find(h=>h.uid===f.uid)||r.push(f),r),[]);console.log("Matches encontrados:",b),s(b),l(I)}catch(k){console.error("Error loading matches:",k),x("Error al cargar matches")}finally{t(!1)}},P=n==="all"?a:a.filter(u=>{var g;return((g=u.friendInfo)==null?void 0:g.uid)===n});return c.useEffect(()=>{w();const u=setInterval(w,3e4);return()=>clearInterval(u)},[]),{matches:P,allMatches:a,friends:i,selectedFriend:n,setSelectedFriend:d,loading:o,error:m,refetch:w}}function me(){const{user:a}=$(),{matches:s,allMatches:i,friends:l,selectedFriend:n,setSelectedFriend:d,loading:o}=X();return a?o?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-muted rounded w-2/3"}),e.jsx("div",{className:"h-20 bg-muted rounded"}),[...Array(3)].map((t,m)=>e.jsx("div",{className:"h-24 bg-muted rounded"},m))]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{title:"Matches",description:"Planes en los que coincidieron",icon:e.jsx(v,{className:"w-8 h-8 md:w-10 md:h-10 text-white"}),badge:{text:`${i.length} ${i.length===1?"match":"matches"}`,className:"bg-gradient-to-r from-pink-500 to-red-500 text-white"}}),l.length>0&&e.jsx(Q,{friends:l,selectedFriend:n,onFriendSelect:d,totalMatches:i.length,filteredMatches:s.length}),s.length===0?e.jsx(q,{icon:e.jsx(v,{className:"w-8 h-8 text-muted-foreground"}),title:n==="all"?"Sin matches aún":"Sin matches con este amigo",description:n==="all"?"Cuando tú y tus amigos marquen el mismo plan como favorito, aparecerá aquí como un match.":"No tienes matches con este amigo todavía. ¡Exploren juntos los planes disponibles!",tip:"Explora la sección de Planes para encontrar actividades que te gusten"}):e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsx(O,{match:t},t.id))})})]}):e.jsx(L,{})}export{me as default};
