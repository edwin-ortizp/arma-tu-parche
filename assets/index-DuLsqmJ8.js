const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TinderStack-DwpQwt4y.js","assets/framer-motion-B4_CJGXS.js","assets/card-DpKgxsRQ.js","assets/index-CeOkkNmr.js","assets/radix-ui-C_8bfTb2.js","assets/firebase-CKBzFk3f.js","assets/ui-utils-B2rm_Apj.js","assets/index-BQq-VcGM.css","assets/PageHeader-BNAMylMS.js","assets/x-DPwxWe9s.js","assets/EmptyState-BmyRMRAD.js"])))=>i.map(i=>d[i]);
import{c as U,d as y,a as S,u as F,b as V,U as G,_ as O}from"./index-CeOkkNmr.js";import{j as e,r as b}from"./framer-motion-B4_CJGXS.js";import{P as W}from"./PageHeader-BNAMylMS.js";import{E as _,C as T,M as I}from"./EmptyState-BmyRMRAD.js";import{C as B,a as J,b as K,c as Q}from"./card-DpKgxsRQ.js";import{A as z,a as H,u as X}from"./useConnections-CL5poG7k.js";import{C as Y}from"./check-COHvSuY9.js";import{h as L,f as P,d as A,s as $,e as q}from"./firebase-CKBzFk3f.js";import"./radix-ui-C_8bfTb2.js";import"./ui-utils-B2rm_Apj.js";/**
 * @license lucide-react v0.408.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=U("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.408.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=U("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);function ee({connections:a,selected:x,onSelectionChange:p,compact:s=!1}){const f=[{uid:"solo",name:"Para mí",relation:"solo"},...a];if(s&&x){const l=f.find(g=>g.uid===x);if(l)return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-8 h-8",children:e.jsx(H,{className:`text-white text-xs font-semibold ${l.uid==="solo"?"bg-gradient-to-br from-gray-400 to-slate-500":"bg-gradient-to-br from-blue-400 to-cyan-500"}`,children:l.name.charAt(0).toUpperCase()})}),e.jsx("div",{children:e.jsx("p",{className:"font-medium text-sm",children:l.uid==="solo"?"Planes para mí":`Con ${l.name}`})})]}),e.jsx("button",{onClick:()=>p(""),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Cambiar"})]})}return e.jsxs(B,{className:"bg-muted/50 w-full",children:[e.jsx(J,{className:"pb-3",children:e.jsx(K,{className:"text-lg",children:"¿Con quién planeas?"})}),e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-3 gap-2 sm:grid-cols-4 md:grid-cols-5",children:f.map(l=>e.jsxs("button",{onClick:()=>p(l.uid),className:`
                relative p-3 rounded-lg border-2 transition-all duration-200 hover:scale-105
                ${x===l.uid?"border-brand-primary bg-brand-primary/10 shadow-lg":"border-border hover:border-brand-primary/50 bg-background"}
              `,children:[x===l.uid&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-brand-primary rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Y,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(z,{className:"w-10 h-10",children:e.jsx(H,{className:`text-white text-sm font-semibold ${l.uid==="solo"?"bg-gradient-to-br from-gray-400 to-slate-500":"bg-gradient-to-br from-blue-400 to-cyan-500"}`,children:l.name.charAt(0).toUpperCase()})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs font-medium truncate max-w-[60px]",children:l.name})})]})]},l.uid))})})]})}function se(a=!1,x=""){const[p,s]=b.useState([]),[m,f]=b.useState(!0),[l,g]=b.useState(null),j=async()=>{try{f(!0),g(null);const o=await L(P(y,"dates")),c=Date.now();let d=o.docs.map(t=>({id:t.id,...t.data()})).filter(t=>{const i=t.active&&(!t.expiresAt||new Date(t.expiresAt).getTime()>c),h=a?!0:t.relationType==="solo";return i&&h});if(a&&S.currentUser&&x){const t=S.currentUser.uid,i=x==="solo"?t:x,w=(await L(P(y,"likes"))).docs.map(r=>r.data()).filter(r=>{const D=r.userId===t,E=r.companionId===i||!r.companionId&&x==="solo";return D&&E}).map(r=>r.dateId),k=(await L(P(y,"matches"))).docs.map(r=>r.data()).filter(r=>{const D=r.users.includes(t),E=r.users.includes(i);return D&&E}).map(r=>r.dateId),N=[...new Set([...w,...k])];d=d.filter(r=>!N.includes(r.id))}const u=d.sort(()=>Math.random()-.5);s(u)}catch(o){console.error("Error al cargar planes:",o),g("Error al cargar planes")}finally{f(!1)}};return b.useEffect(()=>{j()},[a,x]),{dates:p,loading:m,error:l,likeDate:async(o,c)=>{var d;const n=S.currentUser;if(!n)throw new Error("Usuario no autenticado");try{const u=c==="solo"?n.uid:c,t=`${n.uid}_${u}_${o}`,i=A(y,"likes",t);if(await $(i,{userId:n.uid,dateId:o,companionId:u,liked:!0,createdAt:Date.now()},{merge:!0}),c==="solo"||c===n.uid)return{hasMatch:!1,isNewMatch:!1};try{const h=`${c}_${n.uid}_${o}`,w=A(y,"likes",h),v=await q(w);if(v.exists()&&((d=v.data())==null?void 0:d.liked)===!0){const k=`${[n.uid,c].sort().join("_")}_${o}`,N=A(y,"matches",k);try{return(await q(N)).exists()?{hasMatch:!0,isNewMatch:!1}:(await $(N,{users:[n.uid,c],dateId:o,createdAt:Date.now(),plannedFor:"",status:"pending"},{merge:!0}),{hasMatch:!0,isNewMatch:!0})}catch(r){return console.error("Error creando match:",r),{hasMatch:!1,isNewMatch:!1}}}return{hasMatch:!1,isNewMatch:!1}}catch(h){return console.error("Error verificando likes de otros usuarios:",h),{hasMatch:!1,isNewMatch:!1}}}catch(u){throw console.error("Error al dar like:",u),new Error(`Error al procesar el like: ${u instanceof Error?u.message:"Error desconocido"}`)}},dislikeDate:async(o,c="")=>{const n=S.currentUser;if(!n)throw new Error("Usuario no autenticado");try{const d=c==="solo"?n.uid:c,u=`${n.uid}_${d}_${o}`,t=A(y,"likes",u);return await $(t,{userId:n.uid,dateId:o,companionId:d,liked:!1,createdAt:Date.now()},{merge:!0}),{success:!0}}catch(d){throw console.error("Error al dar dislike:",d),new Error(`Error al procesar el dislike: ${d instanceof Error?d.message:"Error desconocido"}`)}},refreshDates:j}}function ae(){const[a,x]=b.useState(""),[p,s]=b.useState(null),{user:m}=F(),{showToast:f}=V(),l=!!m,{dates:g,loading:j,likeDate:C,dislikeDate:M,refreshDates:o}=se(l,a),{connections:c,loading:n}=X();return{selected:a,setSelected:x,likingDateId:p,user:m,isLogged:l,dates:g,connections:c,loading:j||n,handleLikeDate:async t=>{if(!a)return{hasMatch:!1,isNewMatch:!1};try{s(t);const i=a==="solo"?(m==null?void 0:m.uid)||"solo":a,h=await C(t,i);return a==="solo"?f("Plan guardado para ti","success"):h.hasMatch?f("¡Es un match! 🎉","success"):f("Plan guardado","success"),h.hasMatch&&setTimeout(()=>o(),1e3),h}catch(i){throw console.error("Error al procesar el like:",i),i}finally{s(null)}},handlePassDate:async t=>{if(a)try{const i=a==="solo"?(m==null?void 0:m.uid)||"solo":a;await M(t,i),console.log("Plan marcado como no interesante para este compañero")}catch(i){console.error("Error al marcar como no interesante:",i)}}}}const te=b.lazy(()=>O(()=>import("./TinderStack-DwpQwt4y.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(a=>({default:a.TinderStack}))),re=()=>e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 dark:bg-gray-800 rounded-xl",children:e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Cargando planes..."})]})});function pe(){var j,C,M,o,c,n,d,u,t,i,h,w,v,k,N,r,D,E;const{selected:a,setSelected:x,isLogged:p,dates:s,connections:m,loading:f,handleLikeDate:l,handlePassDate:g}=ae();return f?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-muted rounded w-2/3"})]})}):e.jsxs("div",{className:`pb-20 ${a?"space-y-2":"space-y-6"}`,children:[!p||m.length===0||a===""?e.jsx(W,{title:"Encuentra tu Plan",description:"Descubre actividades perfectas para compartir",icon:e.jsx(Z,{className:"w-5 h-5 text-white"}),badge:{text:`${s.length} planes disponibles`,className:"bg-gradient-to-r from-green-500 to-emerald-500 text-white"}}):null,p&&m.length===0?e.jsx(_,{icon:e.jsx(G,{className:"w-8 h-8 text-muted-foreground"}),title:"¡Conecta con Amigos!",description:"Aún no tienes conexiones. Agrega amigos con su PIN para encontrar planes increíbles juntos.",tip:"Ve a la sección Amigos para conectarte"}):e.jsxs("div",{className:"flex flex-col h-[calc(100vh-120px)]",children:[p&&e.jsx("div",{className:"flex-shrink-0 px-4 mb-4",children:e.jsx(ee,{connections:m,selected:a,onSelectionChange:x,compact:a!==""})}),p&&a===""?e.jsx("div",{className:"px-4",children:e.jsx(_,{icon:e.jsx("span",{className:"text-2xl",children:"👆"}),title:"¿Con quién planeas?",description:"Elige un compañero o selecciona 'Para mí' para planes individuales."})}):e.jsxs("div",{className:"flex flex-col lg:flex-row lg:gap-8 h-full",children:[e.jsx("div",{className:"flex-1 flex justify-center items-center px-2 lg:px-0",children:e.jsxs("div",{className:"w-[95vw] lg:w-full lg:max-w-[500px] space-y-4",children:[e.jsx("div",{className:"h-[calc(100vh-300px)] lg:h-[600px] relative",children:e.jsx(b.Suspense,{fallback:e.jsx(re,{}),children:e.jsx(te,{dates:s,onLike:l,onPass:g})})}),e.jsx("div",{className:"lg:hidden",children:a&&s.length>0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-gray-100 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:(j=s[0])==null?void 0:j.category}),e.jsxs("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),(C=s[0])==null?void 0:C.duration]}),e.jsxs("span",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),(M=s[0])==null?void 0:M.cost]}),((o=s[0])==null?void 0:o.city)&&e.jsxs("span",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),(c=s[0])==null?void 0:c.city]}),((n=s[0])==null?void 0:n.experienceType)&&e.jsx("span",{className:"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium",children:(d=s[0])==null?void 0:d.experienceType})]}),((u=s[0])==null?void 0:u.explanation)&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-100",children:[e.jsx("h5",{className:"text-xs font-medium text-blue-800 mb-1 flex items-center",children:"📝 Ideas para hacerlo"}),e.jsx("p",{className:"text-xs text-blue-700 leading-relaxed",children:s[0].explanation})]})]})})]})}),e.jsx("div",{className:"hidden lg:block lg:w-80 lg:flex-shrink-0 space-y-6",children:a&&s.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-900",children:"Detalles del Plan"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg text-gray-800 mb-2",children:(t=s[0])==null?void 0:t.title}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-3",children:(i=s[0])==null?void 0:i.description}),((h=s[0])==null?void 0:h.explanation)&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-100",children:[e.jsx("h5",{className:"text-sm font-medium text-blue-800 mb-2 flex items-center",children:"📝 Ideas para hacerlo"}),e.jsx("p",{className:"text-sm text-blue-700 leading-relaxed",children:s[0].explanation})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:(w=s[0])==null?void 0:w.category}),e.jsxs("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),(v=s[0])==null?void 0:v.duration]}),e.jsxs("span",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),(k=s[0])==null?void 0:k.cost]}),((N=s[0])==null?void 0:N.city)&&e.jsxs("span",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),(r=s[0])==null?void 0:r.city]}),((D=s[0])==null?void 0:D.experienceType)&&e.jsx("span",{className:"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium",children:(E=s[0])==null?void 0:E.experienceType})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-900",children:"💡 Cómo usar"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 font-bold",children:"→"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Me Gusta"}),e.jsx("p",{className:"text-gray-600",children:"Desliza derecha o usa el botón ❤️"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-red-600 font-bold",children:"←"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Pasar"}),e.jsx("p",{className:"text-gray-600",children:"Desliza izquierda o usa el botón ✗"})]})]})]})]})]})})]})]}),p&&a&&e.jsx("div",{className:"lg:hidden mt-8 px-6 pb-4",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100",children:e.jsxs("p",{className:"text-center text-sm text-gray-600",children:["💡 ",e.jsx("strong",{children:"Tip:"})," Desliza → para me gusta, ← para pasar"]})})})]})}export{pe as default};
